#include "chemsim/ff/uff_params.h"
#include <stdexcept>
#include <vector>

namespace chemsim {

// UFF parameters from Rappe et al., JACS 1992, 114, 10024-10035
// and OpenBabel UFF.prm
// Fields: label, r1, theta0, x1, D1, zeta, Z1, Vi, Uj, Xi, hard, radius
static const std::vector<UFFAtomType> UFF_PARAMS = {
    // Hydrogen
    {"H_",     0.354,  180.0, 2.886, 0.044, 12.000, 0.712, 0.000, 0.000, 4.528, 6.9452, 0.371},
    {"H_b",    0.460,   83.5, 2.886, 0.044, 12.000, 0.712, 0.000, 0.000, 4.528, 6.9452, 0.371},

    // Helium
    {"He4+4",  0.849,   90.0, 2.362, 0.056, 15.240, 0.098, 0.000, 0.000, 9.660, 14.920, 0.849},

    // Lithium
    {"Li",     1.336,  180.0, 2.451, 0.025, 12.000, 1.026, 0.000, 2.000, 3.006, 2.386, 1.557},

    // Beryllium
    {"Be3+2",  1.074,  109.47, 2.745, 0.085, 12.000, 1.565, 0.000, 2.000, 4.877, 4.443, 1.240},

    // Boron
    {"B_3",    0.838,  109.47, 4.083, 0.180, 12.052, 1.755, 0.000, 2.000, 5.110, 4.750, 0.822},
    {"B_2",    0.828,  120.0, 4.083, 0.180, 12.052, 1.755, 0.000, 2.000, 5.110, 4.750, 0.822},

    // Carbon
    {"C_3",    0.757,  109.47, 3.851, 0.105, 12.730, 1.912, 2.119, 0.000, 5.343, 5.063, 0.706},
    {"C_R",    0.729,  120.0, 3.851, 0.105, 12.730, 1.912, 0.000, 2.000, 5.343, 5.063, 0.706},
    {"C_2",    0.732,  120.0, 3.851, 0.105, 12.730, 1.912, 0.000, 2.000, 5.343, 5.063, 0.706},
    {"C_1",    0.706,  180.0, 3.851, 0.105, 12.730, 1.912, 0.000, 0.000, 5.343, 5.063, 0.706},

    // Nitrogen
    {"N_3",    0.700,  106.7, 3.660, 0.069, 13.407, 2.544, 0.450, 0.000, 6.899, 5.880, 0.636},
    {"N_R",    0.699,  120.0, 3.660, 0.069, 13.407, 2.544, 0.000, 2.000, 6.899, 5.880, 0.636},
    {"N_2",    0.685,  111.2, 3.660, 0.069, 13.407, 2.544, 0.000, 2.000, 6.899, 5.880, 0.636},
    {"N_1",    0.656,  180.0, 3.660, 0.069, 13.407, 2.544, 0.000, 0.000, 6.899, 5.880, 0.636},

    // Oxygen
    {"O_3",    0.658,  104.51, 3.500, 0.060, 14.085, 2.300, 0.018, 2.000, 8.741, 6.682, 0.639},
    {"O_3_z",  0.528,  146.0, 3.500, 0.060, 14.085, 2.300, 0.018, 2.000, 8.741, 6.682, 0.639},
    {"O_R",    0.680,  110.0, 3.500, 0.060, 14.085, 2.300, 0.000, 2.000, 8.741, 6.682, 0.639},
    {"O_2",    0.634,  120.0, 3.500, 0.060, 14.085, 2.300, 0.000, 2.000, 8.741, 6.682, 0.639},
    {"O_1",    0.639,  180.0, 3.500, 0.060, 14.085, 2.300, 0.000, 0.000, 8.741, 6.682, 0.639},

    // Fluorine
    {"F_",     0.668,  180.0, 3.364, 0.050, 14.762, 1.735, 0.000, 0.000, 10.874, 7.474, 0.668},

    // Neon
    {"Ne4+4",  0.920,   90.0, 3.243, 0.042, 15.440, 0.194, 0.000, 0.000, 11.040, 10.550, 0.920},

    // Sodium
    {"Na",     1.539,  180.0, 2.983, 0.030, 12.000, 1.081, 0.000, 0.000, 2.843, 2.296, 1.600},

    // Magnesium
    {"Mg3+2",  1.421,  109.47, 3.021, 0.111, 12.000, 1.787, 0.000, 2.000, 3.951, 3.693, 1.500},

    // Aluminum
    {"Al3",    1.244,  109.47, 4.499, 0.505, 11.278, 1.792, 0.000, 2.000, 4.060, 3.590, 1.201},

    // Silicon
    {"Si3",    1.117,  109.47, 4.295, 0.402, 12.175, 2.323, 1.225, 0.000, 4.168, 3.487, 1.176},

    // Phosphorus
    {"P_3+3",  1.101,   93.8, 4.147, 0.305, 13.072, 2.863, 2.400, 0.000, 5.463, 4.000, 1.102},
    {"P_3+5",  1.056,  109.47, 4.147, 0.305, 13.072, 2.863, 2.400, 0.000, 5.463, 4.000, 1.102},
    {"P_3+q",  1.056,  109.47, 4.147, 0.305, 13.072, 2.863, 2.400, 0.000, 5.463, 4.000, 1.102},

    // Sulfur
    {"S_3+2",  1.064,   92.1, 4.035, 0.274, 13.969, 2.703, 0.484, 0.000, 6.928, 4.486, 1.047},
    {"S_3+4",  1.049,  103.2, 4.035, 0.274, 13.969, 2.703, 0.484, 0.000, 6.928, 4.486, 1.047},
    {"S_3+6",  1.027,  109.47, 4.035, 0.274, 13.969, 2.703, 0.484, 0.000, 6.928, 4.486, 1.047},
    {"S_R",    1.077,   92.2, 4.035, 0.274, 13.969, 2.703, 0.000, 2.000, 6.928, 4.486, 1.047},
    {"S_2",    0.854,  120.0, 4.035, 0.274, 13.969, 2.703, 0.000, 0.000, 6.928, 4.486, 1.047},

    // Chlorine
    {"Cl",     1.044,  180.0, 3.947, 0.227, 14.866, 2.348, 0.000, 0.000, 8.564, 4.946, 0.994},

    // Argon
    {"Ar4+4",  1.032,   90.0, 3.868, 0.185, 15.763, 0.300, 0.000, 0.000, 9.465, 6.355, 1.032},

    // Potassium
    {"K_",     1.953,  180.0, 3.812, 0.035, 12.000, 1.165, 0.000, 0.000, 2.421, 1.920, 2.200},

    // Calcium
    {"Ca6+2",  1.761,   90.0, 3.399, 0.238, 12.000, 2.141, 0.000, 0.000, 3.231, 2.880, 1.948},

    // Transition metals (common types)
    {"Ti3+4",  1.412,  109.47, 3.175, 0.017, 12.000, 2.659, 0.000, 0.000, 3.470, 3.470, 1.607},
    {"Ti6+4",  1.412,   90.0, 3.175, 0.017, 12.000, 2.659, 0.000, 0.000, 3.470, 3.470, 1.607},
    {"Fe3+2",  1.370,  109.47, 2.912, 0.013, 12.000, 2.912, 0.000, 0.000, 4.140, 3.760, 1.456},
    {"Fe6+2",  1.370,   90.0, 2.912, 0.013, 12.000, 2.912, 0.000, 0.000, 4.140, 3.760, 1.456},
    {"Co6+3",  1.406,   90.0, 2.872, 0.014, 12.000, 3.100, 0.000, 0.000, 4.220, 3.860, 1.424},
    {"Ni4+2",  1.398,   90.0, 2.834, 0.015, 12.000, 3.200, 0.000, 0.000, 4.310, 3.960, 1.417},
    {"Cu3+1",  1.434,  109.47, 3.495, 0.005, 12.000, 1.756, 0.000, 0.000, 4.220, 4.220, 1.434},
    {"Zn3+2",  1.400,  109.47, 2.763, 0.124, 12.000, 1.308, 0.000, 0.000, 5.106, 4.285, 1.400},

    // Bromine
    {"Br",     1.141,  180.0, 4.189, 0.251, 15.763, 2.519, 0.000, 0.000, 10.126, 5.224, 1.141},

    // Iodine
    {"I_",     1.360,  180.0, 4.750, 0.339, 16.660, 2.650, 0.000, 0.000, 11.547, 5.350, 1.360},
};

static std::unordered_map<std::string, size_t> build_index() {
    std::unordered_map<std::string, size_t> index;
    for (size_t i = 0; i < UFF_PARAMS.size(); ++i) {
        index[UFF_PARAMS[i].label] = i;
    }
    return index;
}

static const std::unordered_map<std::string, size_t>& param_index() {
    static auto index = build_index();
    return index;
}

const UFFAtomType& get_uff_params(const std::string& label) {
    const auto& idx = param_index();
    auto it = idx.find(label);
    if (it == idx.end()) {
        throw std::runtime_error("Unknown UFF atom type: " + label);
    }
    return UFF_PARAMS[it->second];
}

bool has_uff_type(const std::string& label) {
    const auto& idx = param_index();
    return idx.find(label) != idx.end();
}

std::vector<std::string> get_all_uff_types() {
    std::vector<std::string> types;
    types.reserve(UFF_PARAMS.size());
    for (const auto& p : UFF_PARAMS) {
        types.push_back(p.label);
    }
    return types;
}

} // namespace chemsim
